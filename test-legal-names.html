<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Test Legal Name Extraction</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .member-card {
            margin: 15px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .name-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .display-name {
            font-weight: bold;
            color: #1976d2;
        }
        .legal-name {
            font-weight: bold;
            color: #388e3c;
        }
        .name-change {
            background: #fff3e0;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Test Legal Name Extraction</h1>
            <p>Testing the enhanced name extraction with legal names and name changes</p>
        </div>

        <div class="test-section">
            <h2>üìã Test Data</h2>
            <p>Testing with the provided test data that includes legal name changes:</p>
            <ul>
                <li><strong>ZULMIRA HELENA CANTON</strong> ‚Üí <strong>ZULMIRA HELENA CANTON ROCHA</strong></li>
                <li><strong>SORAIA RIBEIRO ABURACHID</strong> ‚Üí <strong>SORAIA RIBEIRO ABURACHID ROCHA</strong></li>
            </ul>
        </div>

        <div id="loading" class="loading">
            üîÑ Loading and testing legal name extraction...
        </div>

        <div id="error-container"></div>
        
        <div id="results-container"></div>
    </div>

    <script src="js/genealogy-data-extractor-fixed.js?v=legal-names&t=20250807"></script>
    <script>
        console.log('üîÑ Loading legal name extraction test...');
        
        // Test data with legal name changes
        const testHTML = `
            <p><strong><span class="c16">BN -</span> <span class="c6">1.1.3.7.4.</span> <span class="c13">ZULMIRA HELENA CANTON</span></strong></p>
            <p><span class="c13">Nascida em 22/05/1938, em Col√¥nia Rodrigo Silva, Barbacena, MG. Casou-se em 21/12/1963, com <strong>LUIZ CARLOS ROCHA</strong>, nascido em 23/12/1940, em Itaguari, ES. Filho de <strong>ROLD√ÉO SIQUEIRA ROCHA</strong> e <strong>MARIA OLINDA LOPES ROCHA</strong>. Ela passou a assinar <strong>ZULMIRA HELENA CANTON ROCHA</strong>.</span></p>
            
            <p><strong><span class="c37">TN -</span> <span class="c6">1.1.3.7.4.1.</span> <span class="c13">LUIZ CARLOS ROCHA J√öNIOR</span></strong></p>
            <p><span class="c13">Nascido em 23/09/1964, em Belo Horizonte, MG. Casou-se em 09/12/1989, com <strong>SORAIA RIBEIRO ABURACHID</strong>, que passou a assinar <strong>SORAIA RIBEIRO ABURACHID ROCHA</strong>, nascida em 17/10/1967, em Belo Horizonte, MG. Filha de <strong>JOS√â MARIA ABURACHID</strong> e <strong>ELVIRA MARIA RIBEIRO ABURACHID</strong>.</span></p>
            
            <p><strong><span class="c18">QN -</span> <span class="c6">1.1.3.7.4.1.1.</span> <span class="c13">AMANDA ABURACHID ROCHA</span></strong></p>
            <p><span class="c13">Nascida em 08/09/1991, em Belo Horizonte, MG.</span></p>
            
            <p><strong><span class="c18">QN -</span> <span class="c6">1.1.3.7.4.1.2.</span> <span class="c13">B√ÅRBARA ABURACHID ROCHA</span></strong></p>
            <p><span class="c13">Nascida em 04/12/1992, em Belo Horizonte, MG.</span></p>
            
            <p><strong><span class="c18">QN -</span> <span class="c6">1.1.3.7.4.1.3.</span> <span class="c13">CLARISSA ABURACHID ROCHA</span></strong></p>
            <p><span class="c13">Nascida em 02/01/1996, em Belo Horizonte, MG.</span></p>
        `;

        async function testLegalNameExtraction() {
            try {
                console.log('üîÑ Starting legal name extraction test...');
                
                if (typeof GenealogyDataExtractor === 'undefined') {
                    throw new Error('GenealogyDataExtractor not loaded');
                }

                const extractor = new GenealogyDataExtractor();
                const result = await extractor.extractFromHTML(testHTML);
                
                console.log('‚úÖ Legal name extraction test completed');
                console.log('üìä Extracted data:', result);
                
                displayResults(result);
                
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå Error in legal name extraction test:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-container').innerHTML = `
                    <div class="error-message">
                        <h3>‚ùå Error in Legal Name Extraction Test</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Stack:</strong> ${error.stack}</p>
                    </div>
                `;
            }
        }

        function displayResults(data) {
            const container = document.getElementById('results-container');
            
            let html = '<h2>üìä Test Results</h2>';
            
            data.familyMembers.forEach(member => {
                const hasLegalName = member.legalName && member.legalName !== member.name;
                const hasNameChanges = member.nameChanges && member.nameChanges.length > 0;
                
                html += `
                    <div class="member-card">
                        <h3>üë§ ${member.name} (ID: ${member.id})</h3>
                        
                        <div class="name-info">
                            <div class="display-name">
                                üìù Display Name: ${member.name}
                            </div>
                            <div class="legal-name">
                                ‚öñÔ∏è Legal Name: ${member.legalName || 'Same as display name'}
                            </div>
                            ${hasLegalName ? '<div class="success">‚úÖ Legal name differs from display name</div>' : '<div class="info">‚ÑπÔ∏è No legal name change detected</div>'}
                        </div>
                        
                        ${hasNameChanges ? `
                            <div class="name-change">
                                <h4>üîÑ Name Changes:</h4>
                                ${member.nameChanges.map(change => `
                                    <div style="margin: 10px 0; padding: 10px; background: #fff3e0; border-radius: 5px;">
                                        <strong>From:</strong> ${change.from}<br>
                                        <strong>To:</strong> ${change.to}<br>
                                        <strong>Reason:</strong> ${change.reason}<br>
                                        <strong>Date:</strong> ${change.date || 'Unknown'}<br>
                                        <strong>Spouse:</strong> ${change.spouse || 'Unknown'}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 15px;">
                            <strong>Generation:</strong> ${member.generation}<br>
                            <strong>Gender:</strong> ${member.gender}<br>
                            <strong>Birth Info:</strong> ${member.birthInfo || 'Not available'}
                        </div>
                        
                        <details style="margin-top: 15px;">
                            <summary style="cursor: pointer; color: #667eea; font-weight: bold;">üìã Full Data</summary>
                            <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; overflow-x: auto;">${JSON.stringify(member, null, 2)}</pre>
                        </details>
                    </div>
                `;
            });
            
            // Summary statistics
            const totalMembers = data.familyMembers.length;
            const membersWithLegalNames = data.familyMembers.filter(m => m.legalName && m.legalName !== m.name).length;
            const membersWithNameChanges = data.familyMembers.filter(m => m.nameChanges && m.nameChanges.length > 0).length;
            
            html += `
                <div class="test-section">
                    <h3>üìà Summary Statistics</h3>
                    <ul>
                        <li><strong>Total Members:</strong> ${totalMembers}</li>
                        <li><strong>Members with Legal Names:</strong> ${membersWithLegalNames}</li>
                        <li><strong>Members with Name Changes:</strong> ${membersWithNameChanges}</li>
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Initialize when page loads
        window.addEventListener('load', testLegalNameExtraction);
    </script>
</body>
</html>
