<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Árvore Genealógica - Família Grizzo . Grice . Gris . Grissi</title>

    <link rel="stylesheet" type="text/css" href="index.css" />
    <link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/4.1.1/normalize.min.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="js/modern-search.css" />

    <!-- Google Analytics -->
    <script>
        window.ga = window.ga || function() {
            (ga.q = ga.q || []).push(arguments)
        };
        ga.l = +new Date;
        ga('create', 'UA-80216670-1', 'auto');
        ga('require', 'linkid');
        ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
</head>

<body>
    <!-- mobile code -->
    <div class="mobile">
        <div id="mobile-titulo"><span>Família Grizzo . Grice . Gris . Grissi</span></div>
        <div id="mobile-subtitulo"><span>Uma família originalmente italiana</span></div>
        <div id="mobile-centralizarmenu">
            <div id="navcontainer">
                <ul id="navlist">
                    <li>|<a href="./"> Página Principal</a> |</li>
                    <li><a href="./arvore-genealogica.html" id="current"> Árvore Genealógica</a> |</li>
                    <li><a href="./historia.html"> História</a> |</li>
                    <li><a href="./lembrancas.html"> Lembranças</a> |</li>
                    <li><a href="./fotos.html"> Fotos</a> |</li>
                    <li><a href="./contato.html"> Contato</a> |</li>
                </ul>
            </div>
        </div>

        <div id="intro">
            <div id="arvore-content">
                <!-- The genealogy tree content will be loaded here -->
            </div>
        </div>
        <div id="rodape" class="legenda">
            <p align="center">© <a href="mailto:criscmaia@gmail.com?Subject=Família Grizzo%20.%20Grice%20.%20Gris%20.%20Grissi">Cristiano Maia</a> - 2004-<script>document.write(new Date().getFullYear())</script></p>
        </div>
    </div>

    <script>
        // Function to check if an image exists
        async function imageExists(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        // Function to add camera icon to a text element
        async function addCameraToText(textElement, personName) {
            console.log('addCameraToText called for:', personName);
            const photoUrl = `./images/arvore/${encodeURIComponent(personName)}.jpg`;
            const hasPhoto = await imageExists(photoUrl);
            console.log('Has photo for', personName, ':', hasPhoto);
            
            if (hasPhoto) {
                console.log('Adding camera icon to biographical name:', personName);
                // Create camera icon
                const cameraIcon = document.createElement('img');
                cameraIcon.src = './images/arvore/camera.png';
                cameraIcon.alt = 'camera';
                cameraIcon.className = 'icone';
                cameraIcon.style.marginRight = '4px';
                cameraIcon.style.verticalAlign = 'middle';
                
                // Create tooltip wrapper
                const tooltipWrapper = document.createElement('span');
                tooltipWrapper.className = 'tooltip';
                tooltipWrapper.style.display = 'inline-block';
                
                // Create photo span
                const photoSpan = document.createElement('span');
                photoSpan.className = 'foto';
                
                // Create the photo image
                const photoImg = document.createElement('img');
                photoImg.src = photoUrl;
                photoImg.alt = personName;
                photoImg.onerror = function() {
                    this.style.display = 'none';
                };
                
                // Assemble the structure - both camera and name inside tooltip wrapper
                photoSpan.appendChild(photoImg);
                tooltipWrapper.appendChild(cameraIcon);
                tooltipWrapper.appendChild(document.createTextNode(personName));
                tooltipWrapper.appendChild(photoSpan);
                
                // Clear the strong element and add the tooltip wrapper
                textElement.innerHTML = '';
                textElement.appendChild(tooltipWrapper);
            }
        }

        // Function to load and process the genealogy tree
        async function loadGenealogyTree() {
            try {
                console.log('Loading genealogy tree...');
                const response = await fetch('./arvore.html');
                let data = await response.text();
                
                // First, load the content into the DOM
                document.getElementById('arvore-content').innerHTML = data;
                console.log('Content loaded into DOM');
                
                // Process person names in headers
                const personNames = document.querySelectorAll('.person-name');
                console.log('Found', personNames.length, 'person names in headers');
                
                for (const personNameElement of personNames) {
                    const personName = personNameElement.textContent.trim();
                    console.log('Processing header name:', personName);
                    
                    // Check if this person has a photo by testing if the image exists
                    const photoUrl = `./images/arvore/${encodeURIComponent(personName)}.jpg`;
                    const hasPhoto = await imageExists(photoUrl);
                    console.log('Has photo for', personName, ':', hasPhoto);
                    
                    if (hasPhoto) {
                        console.log('Adding camera icon to', personName);
                        // Create camera icon
                        const cameraIcon = document.createElement('img');
                        cameraIcon.src = './images/arvore/camera.png';
                        cameraIcon.alt = 'camera';
                        cameraIcon.className = 'icone';
                        cameraIcon.style.marginRight = '4px';
                        cameraIcon.style.verticalAlign = 'middle';
                        
                        // Create tooltip wrapper
                        const tooltipWrapper = document.createElement('span');
                        tooltipWrapper.className = 'tooltip';
                        tooltipWrapper.style.display = 'inline-block';
                        
                        // Create photo span
                        const photoSpan = document.createElement('span');
                        photoSpan.className = 'foto';
                        
                        // Create the photo image
                        const photoImg = document.createElement('img');
                        photoImg.src = photoUrl;
                        photoImg.alt = personName;
                        photoImg.onerror = function() {
                            this.style.display = 'none';
                        };
                        
                        // Assemble the structure - both camera and name inside tooltip wrapper
                        photoSpan.appendChild(photoImg);
                        tooltipWrapper.appendChild(cameraIcon);
                        tooltipWrapper.appendChild(document.createTextNode(personName));
                        tooltipWrapper.appendChild(photoSpan);
                        
                        // Clear the person name element and add the tooltip wrapper
                        personNameElement.innerHTML = '';
                        personNameElement.appendChild(tooltipWrapper);
                    }
                }
                
                // Process names mentioned in biographical information
                const personInfoSections = document.querySelectorAll('.person-info');
                console.log('Found', personInfoSections.length, 'person info sections');
                
                for (const infoSection of personInfoSections) {
                    const paragraphs = infoSection.querySelectorAll('p');
                    
                    for (const paragraph of paragraphs) {
                        // Get all strong elements (names) in the paragraph
                        const strongElements = paragraph.querySelectorAll('strong');
                        
                        for (const strongElement of strongElements) {
                            const personName = strongElement.textContent.trim();
                            console.log('Processing biographical name:', personName);
                            
                            // Skip if it's just a single word or very short
                            if (personName.length < 3 || personName.split(' ').length < 2) {
                                continue;
                            }
                            
                            // Add camera icon to this name
                            await addCameraToText(strongElement, personName);
                        }
                    }
                }
                
            } catch (error) {
                console.error('Error loading genealogy tree:', error);
                document.getElementById('arvore-content').innerHTML = '<p>Erro ao carregar a árvore genealógica.</p>';
            }
        }

        // Load the genealogy tree when the page loads
        document.addEventListener('DOMContentLoaded', loadGenealogyTree);
    </script>
    
    <!-- Modern Search Script -->
    <script src="js/modern-search.js"></script>
</body>
</html> 