<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test - Final Genealogy Implementation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .test-result { font-weight: bold; margin: 10px 0; }
        .test-details { margin: 10px 0; font-size: 14px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #test-results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>🧪 Final Genealogy Implementation Test</h1>
    
    <div class="test-section info">
        <h2>📋 Test Overview</h2>
        <p>This test validates that the final implementation meets all requirements:</p>
        <ul>
            <li>✅ Layout matches original arvore-genealogica.html</li>
            <li>✅ Complete genealogy.json data loads correctly</li>
            <li>✅ All 440 family members display properly</li>
            <li>✅ 7 generations of data are accessible</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🔍 File Structure Tests</h2>
        <button onclick="testFileStructure()">Test File Structure</button>
        <div id="file-structure-results"></div>
    </div>

    <div class="test-section">
        <h2>📊 Data Loading Tests</h2>
        <button onclick="testDataLoading()">Test Data Loading</button>
        <div id="data-loading-results"></div>
    </div>

    <div class="test-section">
        <h2>🎨 Layout Comparison Tests</h2>
        <button onclick="testLayoutComparison()">Test Layout Comparison</button>
        <div id="layout-comparison-results"></div>
    </div>

    <div class="test-section">
        <h2>🚀 Integration Tests</h2>
        <button onclick="testIntegration()">Test Full Integration</button>
        <div id="integration-results"></div>
    </div>

    <div class="test-section">
        <h2>📈 Performance Tests</h2>
        <button onclick="testPerformance()">Test Performance</button>
        <div id="performance-results"></div>
    </div>

    <div id="test-results"></div>

    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0
        };

        function logResult(testName, passed, details = '') {
            testResults.total++;
            if (passed) {
                testResults.passed++;
                console.log(`✅ ${testName}: PASSED`);
            } else {
                testResults.failed++;
                console.log(`❌ ${testName}: FAILED`);
            }
            if (details) console.log(`   Details: ${details}`);
        }

        function updateResultsDisplay(containerId, results) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="test-result ${results.passed ? 'pass' : 'fail'}">
                    ${results.passed ? '✅ PASSED' : '❌ FAILED'}: ${results.name}
                </div>
                <div class="test-details">${results.details}</div>
            `;
        }

        async function testFileStructure() {
            const results = { name: 'File Structure Test', passed: false, details: '' };
            
            try {
                // Test if required files exist
                const requiredFiles = [
                    'arvore-genealogica-final.html',
                    'js/final-family-renderer.js',
                    'genealogy.json',
                    'arvore.css',
                    'index.css'
                ];

                const fileChecks = await Promise.all(requiredFiles.map(async (file) => {
                    try {
                        const response = await fetch(file);
                        return { file, exists: response.ok };
                    } catch (error) {
                        return { file, exists: false };
                    }
                }));

                const missingFiles = fileChecks.filter(check => !check.exists);
                
                if (missingFiles.length === 0) {
                    results.passed = true;
                    results.details = `All required files found: ${requiredFiles.join(', ')}`;
                } else {
                    results.details = `Missing files: ${missingFiles.map(f => f.file).join(', ')}`;
                }

                logResult('File Structure', results.passed, results.details);
                updateResultsDisplay('file-structure-results', results);

            } catch (error) {
                results.details = `Error: ${error.message}`;
                logResult('File Structure', false, results.details);
                updateResultsDisplay('file-structure-results', results);
            }
        }

        async function testDataLoading() {
            const results = { name: 'Data Loading Test', passed: false, details: '' };
            
            try {
                // Test if genealogy.json loads correctly
                const response = await fetch('genealogy.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                // Validate data structure
                const hasMetadata = data.metadata && data.metadata.totalMembers && data.metadata.generations;
                const hasFamilyMembers = data.familyMembers && Array.isArray(data.familyMembers);
                const correctMemberCount = data.familyMembers.length === 440;
                const correctGenerations = data.metadata.generations === 7;

                if (hasMetadata && hasFamilyMembers && correctMemberCount && correctGenerations) {
                    results.passed = true;
                    results.details = `✅ Loaded ${data.familyMembers.length} members across ${data.metadata.generations} generations`;
                } else {
                    results.details = `❌ Data validation failed: metadata=${hasMetadata}, members=${hasFamilyMembers}, count=${correctMemberCount}, generations=${correctGenerations}`;
                }

                logResult('Data Loading', results.passed, results.details);
                updateResultsDisplay('data-loading-results', results);

            } catch (error) {
                results.details = `Error loading genealogy.json: ${error.message}`;
                logResult('Data Loading', false, results.details);
                updateResultsDisplay('data-loading-results', results);
            }
        }

        async function testLayoutComparison() {
            const results = { name: 'Layout Comparison Test', passed: false, details: '' };
            
            try {
                // Test if the new page loads without errors
                const response = await fetch('arvore-genealogica-final.html');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const html = await response.text();
                
                // Check for required elements
                const hasHeader = html.includes('sticky top-0 z-50 w-full border-b');
                const hasNavigation = html.includes('Família Grizzo . Grice . Gris . Grissi');
                const hasSearchSection = html.includes('search-filter-section');
                const hasFamilyMembers = html.includes('family-members');
                const hasFooter = html.includes('Cristiano Maia');
                const hasFinalRenderer = html.includes('final-family-renderer.js');

                if (hasHeader && hasNavigation && hasSearchSection && hasFamilyMembers && hasFooter && hasFinalRenderer) {
                    results.passed = true;
                    results.details = '✅ All required layout elements found in final page';
                } else {
                    results.details = `❌ Missing elements: header=${hasHeader}, nav=${hasNavigation}, search=${hasSearchSection}, members=${hasFamilyMembers}, footer=${hasFooter}, renderer=${hasFinalRenderer}`;
                }

                logResult('Layout Comparison', results.passed, results.details);
                updateResultsDisplay('layout-comparison-results', results);

            } catch (error) {
                results.details = `Error testing layout: ${error.message}`;
                logResult('Layout Comparison', false, results.details);
                updateResultsDisplay('layout-comparison-results', results);
            }
        }

        async function testIntegration() {
            const results = { name: 'Integration Test', passed: false, details: '' };
            
            try {
                // Test if the JavaScript renderer loads correctly
                const response = await fetch('js/final-family-renderer.js');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const js = await response.text();
                
                // Check for required JavaScript functionality
                const hasClass = js.includes('class FinalFamilyRenderer');
                const hasInitialize = js.includes('async initialize()');
                const hasLoadData = js.includes('loadFamilyData()');
                const hasRenderMembers = js.includes('renderFamilyMembers()');
                const hasGenealogyJson = js.includes('genealogy.json');

                if (hasClass && hasInitialize && hasLoadData && hasRenderMembers && hasGenealogyJson) {
                    results.passed = true;
                    results.details = '✅ All required JavaScript functionality found';
                } else {
                    results.details = `❌ Missing functionality: class=${hasClass}, initialize=${hasInitialize}, loadData=${hasLoadData}, renderMembers=${hasRenderMembers}, genealogyJson=${hasGenealogyJson}`;
                }

                logResult('Integration', results.passed, results.details);
                updateResultsDisplay('integration-results', results);

            } catch (error) {
                results.details = `Error testing integration: ${error.message}`;
                logResult('Integration', false, results.details);
                updateResultsDisplay('integration-results', results);
            }
        }

        async function testPerformance() {
            const results = { name: 'Performance Test', passed: false, details: '' };
            
            try {
                const startTime = performance.now();
                
                // Test loading time of genealogy.json
                const response = await fetch('genealogy.json');
                const data = await response.json();
                
                const loadTime = performance.now() - startTime;
                
                // Performance thresholds
                const acceptableLoadTime = 2000; // 2 seconds
                const dataSize = JSON.stringify(data).length;
                const acceptableDataSize = 1000000; // 1MB
                
                if (loadTime < acceptableLoadTime && dataSize < acceptableDataSize) {
                    results.passed = true;
                    results.details = `✅ Load time: ${loadTime.toFixed(2)}ms, Data size: ${(dataSize / 1024).toFixed(2)}KB`;
                } else {
                    results.details = `❌ Performance issues: Load time: ${loadTime.toFixed(2)}ms (max: ${acceptableLoadTime}ms), Data size: ${(dataSize / 1024).toFixed(2)}KB (max: ${acceptableDataSize / 1024}KB)`;
                }

                logResult('Performance', results.passed, results.details);
                updateResultsDisplay('performance-results', results);

            } catch (error) {
                results.details = `Error testing performance: ${error.message}`;
                logResult('Performance', false, results.details);
                updateResultsDisplay('performance-results', results);
            }
        }

        // Auto-run tests when page loads
        window.addEventListener('load', async () => {
            console.log('🧪 Starting comprehensive tests...');
            
            await testFileStructure();
            await testDataLoading();
            await testLayoutComparison();
            await testIntegration();
            await testPerformance();
            
            console.log(`\n📊 Test Summary:`);
            console.log(`Total: ${testResults.total}`);
            console.log(`Passed: ${testResults.passed}`);
            console.log(`Failed: ${testResults.failed}`);
            console.log(`Success Rate: ${((testResults.passed / testResults.total) * 100).toFixed(1)}%`);
            
            const summaryDiv = document.getElementById('test-results');
            summaryDiv.innerHTML = `
                <div class="test-section ${testResults.failed === 0 ? 'pass' : 'fail'}">
                    <h2>📊 Final Test Summary</h2>
                    <p><strong>Total Tests:</strong> ${testResults.total}</p>
                    <p><strong>Passed:</strong> ${testResults.passed}</p>
                    <p><strong>Failed:</strong> ${testResults.failed}</p>
                    <p><strong>Success Rate:</strong> ${((testResults.passed / testResults.total) * 100).toFixed(1)}%</p>
                    <p><strong>Status:</strong> ${testResults.failed === 0 ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}</p>
                </div>
            `;
        });
    </script>
</body>
</html>
